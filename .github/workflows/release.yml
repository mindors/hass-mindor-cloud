name: Release

on:
  release:
    types: [published]

# 新增：授予工作流必要的权限
permissions:
  contents: write # 允许写入仓库内容（包括上传 Release Assets）

jobs:
  release-zip:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: 生成插件 zip 包
        run: |
          cd ${{ github.workspace }}/custom_components/mindor_cloud
          zip -r ${{ github.workspace }}/mindor_cloud.zip ./*

      - name: 检查 zip 文件是否生成
        run: ls -la ${{ github.workspace }}

      - name: 上传 zip 到 Release Assets
        uses: svenstaro/upload-release-action@v2 # 或升级到最新版本 v2.8.1
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          file: ${{ github.workspace }}/mindor_cloud.zip
          asset_name: mindor_cloud-${{ github.ref_name }}.zip
          tag: ${{ github.ref }}
          overwrite: true
